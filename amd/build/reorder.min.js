define(["jquery"],function(a){"use strict";function b(b){var e=a(b.currentTarget),f=parseInt(e.data("lastPosition"),10),g=parseInt(e.val(),10);if(f!==g){var h=null,i=a("select.moveto");if(i.each(function(){var b=a(this);return b.attr("id")!==e.attr("id")&&parseInt(b.val(),10)===g?(h=b.closest(".fitem"),!1):void 0}),h){c();var j=e.closest(".fitem");f>g?j.insertBefore(h):j.insertAfter(h),i=a("select.moveto"),i.each(function(b){var c=a(this),d=b+1;c.data("lastPosition",d),c.val(d),c.closest(".fitem").find(".localprofile-number").html(d)}),j.removeClass("localprofile-flash").addClass("localprofile-flash"),d()}}}function c(){var b=a("#region-main form");b.find(".fitem_fgroup").each(function(){var b=a(this);b.closest(".localprofile-combined").length&&b.unwrap()})}function d(){var b=null,c=a("#region-main form");c.find(".fitem_fgroup").each(function(){var c=a(this),d=c.find(".andnextrule");d.length&&(d.prop("checked")?b=b?b.add(c):c:b&&(b=b.add(c),b.wrapAll('<div class="localprofile-combined" />'),b=null))}),b&&(b.wrapAll('<div class="localprofile-combined" />'),b=null),e()}function e(){var b=a("#region-main form .andnextrule");b.closest("span").removeClass("hidden").last().addClass("hidden")}function f(){c(),d()}return{init:function(){var c=a("#region-main form");c.find("select.moveto").each(function(){var b=a(this);b.data("lastPosition",b.val())}),c.on("change","select.moveto",b),c.on("change","input.andnextrule",f),d()}}});